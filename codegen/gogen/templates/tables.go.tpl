/* Autogenerated file. Do not edit manually. */

package {{.Package}}

import (
    "reflect"
	"strings"

	archtypes "github.com/concrete-eth/archetype/types"
	"github.com/ethereum/go-ethereum/accounts/abi"
	"github.com/ethereum/go-ethereum/concrete/lib"

	"github.com/ethereum/go-ethereum/concrete/codegen/datamod"

	{{ range .Imports }}
	{{- if .Name }}{{ .Name }} "{{ .Path }}"
    {{- else }}"{{ .Path }}"{{ end }}
	{{ end }}
)

var TablesABIJson = contract.ContractABI

var TablesSchemaJson = `{{.Json}}`

// TODO: base tempalte for actions and tables

var TableSpecs archtypes.TableSpecs

func init() {
    types := map[string]reflect.Type{
        {{- range .Schemas }}
        "{{.Name}}": reflect.TypeOf({{TableStructNameFn .Name}}{}),
        {{- end }}
    }
    getters := map[string]archtypes.GetterFn{
        {{- range .Schemas }}
        "{{.Name}}": func(ds lib.Datastore) interface{} {
            return mod.New{{.Name}}(ds)
        },
        {{- end }}
    }
    var (
        ABI abi.ABI
        schemas []datamod.TableSchema
        err error
    )
    // Load the contract ABI
    if ABI, err = abi.JSON(strings.NewReader(TablesABIJson)); err != nil {
        panic(err)
    }
    // Load the table schemas
    if schemas, err = datamod.UnmarshalTableSchemas([]byte(TablesSchemaJson), false); err != nil {
        panic(err)
    }
    // Create the specs
    if TableSpecs, err = archtypes.NewTableSpecs(&ABI, schemas, types, getters); err != nil {
        panic(err)
    }
}
